<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Ã‡izim EkranÄ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />


  
  <style>
html, body {
  overscroll-behavior-y: contain;
  touch-action: pan-x pan-y;
}   
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f2f4f7;
  }

  .app-container {
    display: flex;
    height: 100vh;
    width: 100vw;
    overflow: hidden;
  }

  .left-panel {
    width: 340px;
    background: #ffffff;
    border-right: 1px solid #ddd;
    padding: 12px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 8px;
    z-index: 5;
  }

  .left-panel.hidden {
    display: none;
  }

  .toggle-btn {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 1000;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 6px 10px;
    font-size: 18px;
    cursor: pointer;
    display: none;
  }

  .info-text {
    font-size: 12px;
    color: #222;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .info-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    column-gap: 20px;
  }

  .info-row.single {
    grid-template-columns: 1fr;
  }

  .info-item {
    display: flex;
    align-items: center;
    gap: 6px;
    min-width: 0;
  }

  .info-item strong {
    width: 75px;
    flex-shrink: 0;
    font-weight: 600;
    white-space: nowrap;
  }

  .info-item span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .divider {
    height: 2px;
    background: #e53935;
    margin: 6px 0;
    width: 100%;
  }

  .form-row {
    display: grid;
    grid-template-columns: 90px 1fr;
    align-items: center;
    column-gap: 8px;
  }

  .form-row label {
    font-size: 12.5px;
    font-weight: 600;
    white-space: nowrap;
  }

  .form-row select {
    width: 100%;
    padding: 6px;
    font-size: 12px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  /* âœ… EK: Ekstra alanÄ± yan yana yapmak iÃ§in */
  .extra-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 6px 14px;
    font-size: 13px;
  }

  .extra-grid label {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .kol-adet-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: 18px;
  }

  .right-panel {
    flex: 1;
    background: #e9edf2;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #777;
    font-size: 16px;
    cursor: pointer;
    overscroll-behavior: contain;
  }

/* âœ… EK: Balkon tipi alanÄ± */
.balkon-type-area {
  margin-top: 8px;
}

.balkon-type-title {
  font-size: 12.5px;
  font-weight: 600;
  margin-bottom: 6px;
  text-align: center;   /* âœ… ORTALAMA */
}

.balkon-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

.balkon-card {
  border: 1px solid #ccc;
  border-radius: 4px;
  padding: 6px;
  text-align: center;
  cursor: pointer;
  background: #fff;
  font-size: 12px;
}

.balkon-card:hover {
  border-color: #1976d2;
}

.balkon-card.active {
  border-color: #1976d2;
  background: #e3f2fd;
}

.balkon-card img {
  width: 100%;
  height: 42px;
  object-fit: contain;
  margin-top: 4px;
}

</style>
</head>

<body>

<div class="toggle-btn" id="toggleBtn">â˜°</div>

<div class="app-container" id="appContainer">

  <div class="left-panel" id="leftPanel">

    <!-- ÃœST BÄ°LGÄ°LER (AYNEN) -->
    <div class="info-text">
      <div class="info-row">
        <div class="info-item"><strong>Teklif No</strong><span id="teklifNo">-</span></div>
        <div class="info-item"><strong>Tarih</strong><span id="tarih">-</span></div>
      </div>

      <div class="info-row">
        <div class="info-item"><strong>Telefon</strong><span id="telefon">-</span></div>
        <div class="info-item"><strong>Montaj</strong><span id="montaj">-</span></div>
      </div>

      <div class="info-row single">
        <div class="info-item"><strong>MÃ¼ÅŸteri</strong><span id="musteri">-</span></div>
      </div>
    </div>

    <div class="divider"></div>

    <div class="form-row"><label>Sistem</label><select id="sistemSelect"></select></div>
    <div class="form-row"><label>AlÃ¼minyum</label><select id="aluminyumSelect"></select></div>
    <div class="form-row"><label>Cam</label><select id="camSelect"></select></div>

    <!-- ðŸ”´ ESKÄ° extraSelect SÄ°LÄ°NMEDÄ° -->
    <div class="form-row" style="display:none;">
      <label>Ekstra</label>
      <select id="extraSelect"></select>
    </div>

    <div class="divider"></div>

    <!-- âœ… EKSTRA â€“ YAN YANA -->
    <div class="extra-grid">

      <label><input type="checkbox" id="chkDamlalik"> DamlalÄ±k profili</label>
      <label><input type="checkbox" id="chkPerdelik"> Perdelik profili</label>

      <label><input type="checkbox" id="chkBaca"> Baca</label>
      <label><input type="checkbox" id="chkMenfez"> Menfez</label>

      <label><input type="checkbox" id="chkKol"> Kol</label>

      <div class="kol-adet-row" id="kolAdetWrapper" style="display:none;">
        Kol Adet
        <input
          type="number"
          id="kolAdet"
          min="0.5"
          step="0.5"
          value="1"
          style="width:50px;">
      </div>

    </div> <!-- âœ… extra-grid DOÄžRU YERDE KAPANDI -->

    <!-- âœ… BALKON TÄ°PÄ° (GRID DIÅžINDA) -->
    <div class="divider"></div>

    <div class="balkon-type-area">
      <div class="balkon-type-title">Balkon Tipi</div>

      <div class="balkon-grid">

        <div class="balkon-card" data-type="duz">
          DÃ¼z Balkon
          <img src="img/duz.png">
        </div>

        <div class="balkon-card" data-type="u">
          U Balkon
          <img src="img/u.png">
        </div>

        <div class="balkon-card" data-type="l">
          L Balkon
          <img src="img/l.png">
        </div>

        <div class="balkon-card" data-type="l2">
          L Balkon
          <img src="img/l2.png">
        </div>

      </div>
    </div>

    <!-- Sheet iÃ§in -->
    <input type="hidden" id="balkon_tipi" value="">

    <!-- âœ… EK: TRUE / FALSE Sheet iÃ§in (AYNEN) -->
    <input type="hidden" id="extra_damlalik" value="FALSE">
    <input type="hidden" id="extra_perdelik" value="FALSE">
    <input type="hidden" id="extra_baca" value="FALSE">
    <input type="hidden" id="extra_menfez" value="FALSE">
    <input type="hidden" id="extra_kol" value="FALSE">

  </div>

<div class="right-panel" id="rightPanel">
  <iframe
    id="drawingFrame"
    src=""
    style="
      width:100%;
      height:100%;
      border:none;
      background:#fff;
    ">
  </iframe>
</div>


</div>


<script>
/* PANEL AÃ‡ / KAPA (AYNEN) */
const leftPanel = document.getElementById("leftPanel");
const rightPanel = document.getElementById("rightPanel");
const toggleBtn = document.getElementById("toggleBtn");

function updateToggle() {
  toggleBtn.style.display = leftPanel.classList.contains("hidden") ? "block" : "none";
}

leftPanel.addEventListener("click", e => e.stopPropagation());

toggleBtn.addEventListener("click", e => {
  e.stopPropagation();
  leftPanel.classList.remove("hidden");
  updateToggle();
});

rightPanel.addEventListener("click", () => {
  leftPanel.classList.add("hidden");
  updateToggle();
});

updateToggle();
</script>

<script>
/* âœ… EK: TRUE / FALSE BAÄžLAMA */
const extraMap = [
  ["chkDamlalik", "extra_damlalik"],
  ["chkPerdelik", "extra_perdelik"],
  ["chkBaca", "extra_baca"],
  ["chkMenfez", "extra_menfez"],
  ["chkKol", "extra_kol"]
];

extraMap.forEach(([chkId, hiddenId]) => {
  const chk = document.getElementById(chkId);
  const hidden = document.getElementById(hiddenId);
  chk.addEventListener("change", () => {
    hidden.value = chk.checked ? "TRUE" : "FALSE";
  });
});

/* KOL ADET */
const chkKol = document.getElementById("chkKol");
const kolAdetWrapper = document.getElementById("kolAdetWrapper");

chkKol.addEventListener("change", () => {
  kolAdetWrapper.style.display = chkKol.checked ? "flex" : "none";
});
</script>

<script>
/* API (AYNEN) */
const API_URL =
"https://script.google.com/macros/s/AKfycby7dpkJcXM46i-Hv1sQUyKwH4r_LL4aSTXQEr1pKaHAhWKB_7VFCYchtbIg8vpdeyYcMg/exec";

function getQueryParam(name) {
  return new URLSearchParams(window.location.search).get(name);
}

const teklifNo = (getQueryParam("teklifNo") || "").trim();

const teklifNoEl = document.getElementById("teklifNo");
const tarihEl = document.getElementById("tarih");
const musteriEl = document.getElementById("musteri");
const telefonEl = document.getElementById("telefon");
const montajEl = document.getElementById("montaj");

async function fetchJSON(url) {
  const res = await fetch(url);
  return await res.json();
}

async function loadTeklif() {
  if (!teklifNo) return;

  const data = await fetchJSON(
    API_URL + "?action=teklif&teklifNo=" + encodeURIComponent(teklifNo)
  );

  if (data.error) return;

  teklifNoEl.textContent = data.teklifNo || "-";
  tarihEl.textContent = data.tarih || "-";
  musteriEl.textContent = data.musteriAdi || "-";
  telefonEl.textContent = data.telefon || "-";
  montajEl.textContent = data.montajYeri || "-";
}

async function loadSelect(action, id) {
  const list = await fetchJSON(API_URL + "?action=" + action);
  const select = document.getElementById(id);
  select.innerHTML = '<option value="">SeÃ§iniz</option>';
  list.forEach(v => select.add(new Option(v, v)));
}

loadTeklif();
loadSelect("sistemler", "sistemSelect");
loadSelect("aluminyum", "aluminyumSelect");
loadSelect("cam", "camSelect");
</script>

<script>
/* âœ… Balkon tipi seÃ§imi + Ã§izim ekranÄ± aÃ§ma + UYARI */
const balkonCards = document.querySelectorAll(".balkon-card");
const balkonTipiInput = document.getElementById("balkon_tipi");

balkonCards.forEach(card => {
  card.addEventListener("click", () => {

    const newType = card.dataset.type;
    const oldType = balkonTipiInput.value;

    // âš ï¸ Daha Ã¶nce Ã§izim varsa uyar
    if (oldType && oldType !== newType) {
      const ok = confirm("Mevcut Ã§izim iptal edilecek. Devam etmek istiyor musunuz?");
      if (!ok) return;
    }

    // aktif gÃ¶rÃ¼nÃ¼m
    balkonCards.forEach(c => c.classList.remove("active"));
    card.classList.add("active");

    balkonTipiInput.value = newType;

    // ðŸ‘‰ Ã‡Ä°ZÄ°M EKRANI YÃœKLE
    if (newType === "duz") {
      drawingFrame.src = "duz.index.html";
    } else if (newType === "u") {
      drawingFrame.src = "u.index.html";
    } else if (newType === "l") {
      drawingFrame.src = "l.index.html";
    } else if (newType === "l2") {
      drawingFrame.src = "l2.index.html";
    }

    // âœ… Ã‡Ä°ZÄ°M AÃ‡ILINCA SOL PANEL GÄ°ZLENSÄ°N
    leftPanel.classList.add("hidden");
    updateToggle();
  });
});
</script>


<script>
/* âœ… Ã‡Ä°ZÄ°M EKRANINDA Ã‡ALIÅžMAYA BAÅžLAYINCA PANELÄ° GÄ°ZLE */

drawingFrame.addEventListener("load", () => {
  try {
    drawingFrame.contentWindow.addEventListener("mousedown", () => {
      if (!leftPanel.classList.contains("hidden")) {
        leftPanel.classList.add("hidden");
        updateToggle();
      }
    });
  } catch (e) {
    console.warn("iframe click yakalanamadÄ±", e);
  }
});
</script>

  <script>
/* ðŸš¨ SAYFA YENÄ°LENÄ°RSE UYARI */

let hasDrawing = false;

/* Ã‡izim ekranÄ± aÃ§Ä±ldÄ±ÄŸÄ±nda */
drawingFrame.addEventListener("load", () => {
  hasDrawing = true;
});

/* Sayfa kapanma / yenilenme yakalama */
window.addEventListener("beforeunload", function (e) {
  if (hasDrawing) {
    e.preventDefault();
    e.returnValue = "Ã‡izim iptal edilecek. SayfayÄ± yenilemek istediÄŸinize emin misiniz?";
    return e.returnValue;
  }
});
</script>


</body>
</html>




